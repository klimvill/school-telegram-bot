# School Telegram Bot

## База данных
![Архитектура базы данных](docs/static/bd.png)

## Презентация находится в папке docs

## О конфигурации
Вся конфигурация хранится в `src/resources/application.py`.

О том, какие файлы понадобятся и ключи понадобятся для запуска:
  - Токен телеграмм бота поместите в переменное окружение с названием BOT_TOKEN
  - Создайте папку `profile_photos` в папке `resources` в ней хранятся все фото профиля
  - Добавьте файл `users_role.json` в папку `resources` в нём должен быть такой формат
    ``` 
        {
          "admins": [4333125645],
          "beta_testers": [5665545456],
          "teachers": {
            "132165478": ["5а", "6г", "10а"]
          }
        }
    ```
    айдишники админов, бета-тестеров и учителей (["5а", "6г", "10а"] - список классов, которыми учитель управляет).
    Переменные вынесены в отдельный файл, потому что предполагается раздача ролей и управление учителями
    напрямую через бота.
  - Если хотите, чтобы расписание подтягивалось из Google Sheets измените `IS_GOOGLE = True`, потом
    скопируйте ссылку на гугл диск [таблицу](https://docs.google.com/spreadsheets/d/10tHlL4Z_HsXdtDCiLJn2lElQew0aoh-W1J1dOpEKAwA/edit?usp=sharing).
    Создайте ключ от [google api](https://azzrael.ru/google-cloud-platform-create-app).
    Поместите его в папку `src/resources`, назвав `private_key_google.json`.

## Команды
/start — Запуск бота и регистрация, требуется прикрепить фото профиля в формате jpg

/help — помощь

/calls — расписание звонков

/today — расписание на сегодня 

/tomorrow — расписание на завтра

/extraLesson - просмотр дополнительных занятий

/addExtraLesson - добавление дополнительных занятий 

/teachers — список всех учителей 

/account — страница вашего профиля


/send — доступна только для админов, позволяет разослать сообщение остальным пользователям (можно добавлять реакции, файлы и другой медиаконтент (голосовые, геопозиция и т.д., возможно добавлять с телефона))

## API
Есть два варианта подгрузки расписания через файл (`IS_GOOGLE = False`) и из Google Sheets:

В качестве стороннего API используется, API Google Sheets, из которого парсится расписание занятий.

Чтобы включить парсинг расписания из API Google Sheets перейдите в `src/resources/application.py` и установите `IS_GOOGLE = True` 


## Размещение на хостинге 
В качестве хостинга использовал RuVDS, размещал по этому гайду https://habr.com/ru/companies/ruvds/articles/786014/
